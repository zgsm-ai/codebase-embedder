

#### **Epic 1: 自定义知识库**

- **FR-2.1: 知识库管理界面**
  - **用户故事：** 作为一个开发者，我希望在Costrict的设置界面中有一个“知识库管理”面板，我可以在这里看到当前已导入的文档，并且可以添加或移除它们。
  - **交付物：**
    1. 在Costrict的VS Code设置页或侧边栏视图中，增加一个“知识库”管理区域。
    2. 该区域应包含一个“添加文档/文件夹”按钮和一个已导入源的列表。
    3. 知识库系统页面，要支持树状管理，方便用户组织大量知识库。
    4. 列表中的每一项都应有关联的“移除”按钮。
  - **验收标准：**
    1. 用户可以通过点击按钮，打开文件/文件夹选择器。
    2. 成功选择`.md`文件或包含`.md`文件的文件夹后，该源会出现在列表中。
    3. 点击“移除”按钮后，相应的源会从列表中消失，并且其对应的向量化数据也会从数据库中被删除。
    4. 点击某个md文档，该文档会出现在vscode编辑窗口，支持编辑该知识
    5. 每当知识库有变动时，需要增量 向量化该变动，存储起来。

------



#### **Epic 2: AI统一检索接口**

- **FR-3.1: 知识库检索Function Call**
  - **用户故事：** 作为AI应用层的开发人员，我需要一个稳定且高效的内部API（作为Function Call暴露给LLM），通过输入自然语言查询，就能从本地向量数据库中获得最相关的上下文片段。
  - **交付物：**
    1. 一个名为`search_knowledge_base(query: str, top_k: int = 5)`的函数或方法。
    2. 该函数负责将输入的`query`文本进行向量化，查询本地向量数据库。
    3. 应用Rerank模型对初步检索结果进行重排序，提升精准度。
    4. 返回`top_k`个最相关的文本片段（Chunks）及其元数据（如来源文件、相关性得分）。
  - **验收标准：**
    1. 该函数接口定义清晰，输入输出符合设计。
    2. 对于一次典型查询，从接收query到返回结果的总耗时应在1秒以内。
    3. 在LLM的调用逻辑中，当需要外部知识时，能够正确地构造并调用此函数。

**3. 效果验收方案（量化标准）**

这是本迭代成功的关键，我们需要量化“精准”的定义。

- **3.1. 建立评测基准 (Benchmark)**
  1. **选取/创建一个标准测试项目：** 选择一个功能完整、代码量适中（1-5万行）的开源项目（如 `express`, `fastapi` 的某个demo项目）。
  2. **构建“黄金问题-答案对” (Golden Q&A Pairs)：** 手动编写20-30个关于此项目的典型开发问题，并明确指出答案存在于哪个/哪些源文件或文档片段中。
     - **示例问题：** “如何在项目中添加一个新的认证中间件？”
     - **黄金答案（源）：** 指向 `src/middlewares/auth.ts` 文件的特定函数定义。
     - **示例问题：** “项目的数据库Schema是如何定义的？”
     - **黄金答案（源）：** 指向 `docs/database.md` 或 `src/models/user.ts`。
- **3.2. 验收指标**
  - **指标1：检索准确率 (Retrieval Accuracy - Hit Rate @ K)**
    - **定义：** 对于一个“黄金问题”，如果其对应的“黄金答案（源）”出现在`search_knowledge_base`函数返回的前K个结果中，则视为命中。
    - **验收标准：** **Hit Rate @ 3 >= 90%**。即对于90%以上的测试问题，正确的上下文信息能排在检索结果的前3位。
  - **指标2：平均倒数排名 (Mean Reciprocal Rank - MRR)**
    - **定义：** 衡量第一个正确答案出现位置的指标。如果第一个正确答案排在第1位，得分为1；排第2，得分为1/2；排第3，得分为1/3，以此类推。MRR是所有问题得分的平均值。
    - **验收标准：** **MRR >= 0.75**。这代表总体上，正确的答案平均能排在第一或第二位。
  - **指标3：端到端任务成功率 (End-to-End Task Success Rate)**
    - **定义：** 这是最终的业务指标。对10个预设的、需要背景知识才能完成的编码任务（如“基于现有API文档，为`getUserProfile`函数编写一个调用示例”），分别在“有知识库”和“无知识库”两种模式下让AI生成代码。
    - **验收标准：**
      1. **对比基线：** 首先记录“无知识库”模式下的成功率（例如，10个任务中成功2个，成功率20%）。
      2. **最终目标：** “有知识库”模式下的**成功率需达到60%以上**，且生成的代码质量（如正确使用内部函数、遵循项目规范）有评测人员可感知的明显提升。